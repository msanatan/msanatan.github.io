{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2015/08/26/of-context-animations-and-pong/","result":{"data":{"site":{"siteMetadata":{"title":"Marcus Sanatan"}},"markdownRemark":{"id":"97187ab5-e1aa-5a57-9664-8386ee02b64f","excerpt":"Hello people of good testing habits, thought I’d share with you some simple errors that could come your way if you’re not careful with JavaScript. I’m getting…","html":"<p>Hello people of good testing habits, thought I’d share with you some simple errors that could come your way if you’re not careful with JavaScript. I’m getting to get to grips with the canvas element, starting with some basic 2D animations. What better way to do this than make a game? Don’t answer that question… So I read tutorials and docs galore to develop a pong clone to my liking.</p>\n<p>My HTML5 pong clone took about 200 lines of code, not too many bells and whistles but it worked :). And that lovely script had a function I happily stole from <a href=\"https://robots.thoughtbot.com/pong-clone-in-javascript\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">thoughtbot’s pong tutorial</a> (you should read their blog, really good stuff!):</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">animate <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>requestAnimationFrame <span class=\"token operator\">||</span>\n  window<span class=\"token punctuation\">.</span>webkitRequestAnimationFrame <span class=\"token operator\">||</span>\n  window<span class=\"token punctuation\">.</span>mozRequestAnimationFrame <span class=\"token operator\">||</span>\n  <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">FPS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Most modern browsers support the requestAnimationFrame function but it never hurts to cover your bases. Wanting to be able to have menus, settings and other stuff you find in games, I decided to encapsulate and expand my little pong clone. Part of that had me moving the animation function scope to the game engine’s object scope. It seems simple enough, just put it in like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">GameEngine</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>animate <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>requestAnimationFrame <span class=\"token operator\">||</span>\n  window<span class=\"token punctuation\">.</span>webkitRequestAnimationFrame <span class=\"token operator\">||</span>\n  window<span class=\"token punctuation\">.</span>mozRequestAnimationFrame <span class=\"token operator\">||</span>\n  <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">FPS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Done! Well, if you want to get this error (in Google Chrome): <strong>Uncaught TypeError: Illegal invocation</strong>. We can’t just take native methods (console.log and the like) and assign them to an object’s property. This is because of the function’s context - the object within which the function is executed. The requestAnimationFrame needs to be executed in the context of the window object, the above code will execute the function in the context of the GameEngine’s object. Luckily the solution is to simply bind the functions to the window object:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token class-name\">GameEngine</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>animate <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>requestAnimationFrame <span class=\"token operator\">||</span>\n  window<span class=\"token punctuation\">.</span>webkitRequestAnimationFrame <span class=\"token operator\">||</span>\n  window<span class=\"token punctuation\">.</span>mozRequestAnimationFrame <span class=\"token operator\">||</span>\n  <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">setTimeout</span><span class=\"token punctuation\">(</span>callback<span class=\"token punctuation\">,</span> <span class=\"token number\">1000</span> <span class=\"token operator\">/</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token constant\">FPS</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>That way the window context will be used when calling any of them. In my code I use <code class=\"language-text\">bind(this)</code>, which also works. Why? By default the bind function will set ‘this’ to the window object for those native functions.</p>\n<p>Fun fact - there is a global variable named FPS that’s passed to the GameEngine object, hence why this code will work if the last function is called even though the scope of ‘this’ will be the window (I know that’s cheating!). Alternatively, we could keep the definition of GameEngine’s animate without using bind, and use JavaScript’s call function when we execute it. So instead of using the animate function like <code class=\"language-text\">engine.animate(step)</code> we leave out bind and write <code class=\"language-text\">engine.animate.call(window, step)</code>. Can’t say you don’t got options!</p>\n<p>For what it’s worth, it got me a working pong game. You can play it <a href=\"https://msanatan.com/pong-js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a> (with the code <a href=\"https://github.com/msanatan/pong-js\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">here</a>).</p>\n<p>Happy ponging!</p>","frontmatter":{"title":"Of Context, Animations and Pong","tags":["html5","javascript"],"date":"2015-08-26","updated":null}},"previous":{"fields":{"slug":"/blog/2015/06/20/my-first-startup-weekend-tt-improving-lives"},"frontmatter":{"title":"My First Startup Weekend TT - Improving Lives"}},"next":{"fields":{"slug":"/blog/2015/11/07/to-app-or-not-to-app-that-is-not-the-question"},"frontmatter":{"title":"To App, or not to App? That is not the Question"}}},"pageContext":{"id":"97187ab5-e1aa-5a57-9664-8386ee02b64f","previousPostId":"970e6ef2-c7c8-582b-bcc6-663a9edc8580","nextPostId":"13c92527-3e2b-5d79-ae49-e6280db86f81"}},"staticQueryHashes":["1391858338"],"slicesMap":{}}