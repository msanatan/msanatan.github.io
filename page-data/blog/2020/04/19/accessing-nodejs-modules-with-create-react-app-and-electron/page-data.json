{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/2020/04/19/accessing-nodejs-modules-with-create-react-app-and-electron/","result":{"data":{"site":{"siteMetadata":{"title":"Marcus Sanatan"}},"markdownRemark":{"id":"f68b0bed-ac21-502d-8995-4c31536c1969","excerpt":"I recently got an Arduboy, a hackable handheld that I can make games for. There are a lot of awesome games as well, and as an inconsistent but avid gamer, I do…","html":"<p>I recently got an <a rel=\"nofollow noopener noreferrer\" target=\"_blank\" href=\"https://arduboy.com\">Arduboy</a>, a hackable handheld that I can make games for. There are a lot of awesome games as well, and as an inconsistent but avid gamer, I do want to play the best ones. Unfortunately at the time, the only way for me to do so on a Mac was to clone a game from Github and compile it with the <a rel=\"nofollow noopener noreferrer\" target=\"_blank\" href=\"https://www.arduino.cc/en/main/software\">Arduino IDE</a>.</p>\n<p>I asked the Arduboy community, and it seems that some software is coming for Mac but I don’t know when. I found some libraries that I could use to upload games to the Arduboy, the easiest one was <a rel=\"nofollow noopener noreferrer\" target=\"_blank\" href=\"https://github.com/noopkat/avrgirl-arduino\">avrgirl-arduino</a>. Writing a script to do it via the CLI was easy thanks to this awesome library. I figured I’d make an app for it as well.</p>\n<p>The app was made with React using the <code class=\"language-text\">create-react-app</code> tool, and bundled with Electron. The tricky part was setting it up so that I could develop the app in Electron rather than in the browser. The next hurdle was getting the app to access Node.js modules like <code class=\"language-text\">fs</code> and <code class=\"language-text\">avrgirl-arduino</code>. If you’re a similar situation, this bit of info might help.</p>\n<p>We’ll spin up the basic React app and hook it up to Electron. We’ll then configure it to access Node.js modules. Note that I’ve only tested this on my Mac (running Catalina) so your mileage may vary on other OSes and version. Let’s begin with setting up the app!</p>\n<h2>Installing</h2>\n<p>The first step is to create the app. As recommended, we use <code class=\"language-text\">npx</code> to run <code class=\"language-text\">create-react-app</code> instead of installing it globally:</p>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">npx create-react-app super-app</code></pre></div>\n<p>If you’re like me and make Github repositories first, just run:</p>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">npx create-react-app .</code></pre></div>\n<p>Drink some tea or coffee while that’s happening. Even with decent internet and a good machine, this sure takes a while…</p>\n<p>When I first did that, the scrips were completed but none of the React code was added. It seems that I had an older version of <code class=\"language-text\">create-react-app</code> installed locally. Even when I uninstalled it with <code class=\"language-text\">npm</code>, it still existed in my <code class=\"language-text\">/usr/local/bin</code>. So if the code doesn’t load for you, be sure to remove any global installs of <code class=\"language-text\">create-react-app</code>.</p>\n<p>Now in your app directory, let’s install a few more packages:</p>\n<p><a rel=\"nofollow noopener noreferrer\" target=\"_blank\" href=\"https://www.electronjs.org\">Electron</a> which is used to build the app</p>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">npm i --save-dev electron</code></pre></div>\n<p><a rel=\"nofollow noopener noreferrer\" target=\"_blank\" href=\"https://github.com/kimmobrunfeldt/concurrently\">Concurrently</a> and <a rel=\"nofollow noopener noreferrer\" target=\"_blank\" href=\"https://github.com/jeffbski/wait-on\">Wait-on</a> which are helper utilities we use in our scripts to develop Electron apps with a debugger.</p>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">npm i --save-dev concurrently wait-on</code></pre></div>\n<p><a rel=\"nofollow noopener noreferrer\" target=\"_blank\" href=\"https://github.com/harrysolovay/rescripts\">Rescripts</a> which is used to modify <code class=\"language-text\">create-react-app</code>’s webpack configuration, without ejecting the app. We need this to access Node.js libraries.</p>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">npm i --save-dev @rescripts/cli @rescripts/rescript-env</code></pre></div>\n<p>Now that everything is installed, let’s set up our app to use Electron for development.</p>\n<h2>Developing in Electron</h2>\n<p>By default, you develop React apps in the browser. Since we’re using Electron to make it a desktop app, it’s best we develop in Electron than in the browser. As Electron is built upon the Chromium engine, we want to develop with their developer tools as well.</p>\n<p>Let’s start by adding an <code class=\"language-text\">electron.js</code> file in our <code class=\"language-text\">public</code> folder. This will become the main point of entry for our app.</p>\n<p>Create a new file with this content as <code class=\"language-text\">public/electron.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> app<span class=\"token punctuation\">,</span> BrowserWindow <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'electron'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Check if we're running Electron while developing</span>\n<span class=\"token comment\">// It's never a good idea to run developer tools in public</span>\n<span class=\"token keyword\">const</span> isDev <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>mainModule<span class=\"token punctuation\">.</span>filename<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'app.asar'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token operator\">||</span>\n    process<span class=\"token punctuation\">.</span>mainModule<span class=\"token punctuation\">.</span>filename<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">'app'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">===</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">createWindow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> appWindow <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BrowserWindow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">width</span><span class=\"token operator\">:</span> <span class=\"token number\">1024</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">height</span><span class=\"token operator\">:</span> <span class=\"token number\">768</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">webPreferences</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">nodeIntegration</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// If we are in dev mode, load the React app where it's run by default</span>\n    <span class=\"token comment\">// Otherwise load the compiled app from the build folder</span>\n    appWindow<span class=\"token punctuation\">.</span><span class=\"token function\">loadURL</span><span class=\"token punctuation\">(</span>isDev <span class=\"token operator\">?</span> <span class=\"token string\">'http://localhost:3000'</span> <span class=\"token operator\">:</span> <span class=\"token string\">'../build/index.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isDev<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Open dev tools alongside our running app</span>\n        appWindow<span class=\"token punctuation\">.</span>webContents<span class=\"token punctuation\">.</span><span class=\"token function\">openDevTools</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    appWindow<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'closed'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> appWindow <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'ready'</span><span class=\"token punctuation\">,</span> createWindow<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Quit when all windows are closed.</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'window-all-closed'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// This is taken from their tutorial: https://www.electronjs.org/docs/tutorial/first-app</span>\n    <span class=\"token comment\">// On macOS it is common for applications and their menu bar</span>\n    <span class=\"token comment\">// to stay active until the user quits explicitly with Cmd + Q</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>process<span class=\"token punctuation\">.</span>platform <span class=\"token operator\">!==</span> <span class=\"token string\">'darwin'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        app<span class=\"token punctuation\">.</span><span class=\"token function\">quit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\napp<span class=\"token punctuation\">.</span><span class=\"token function\">on</span><span class=\"token punctuation\">(</span><span class=\"token string\">'activate'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// This is taken from their tutorial: https://www.electronjs.org/docs/tutorial/first-app</span>\n    <span class=\"token comment\">// On macOS it's common to re-create a window in the app when the</span>\n    <span class=\"token comment\">// dock icon is clicked and there are no other windows open.</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>BrowserWindow<span class=\"token punctuation\">.</span><span class=\"token function\">getAllWindows</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">createWindow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>For those curious, I created the <code class=\"language-text\">isDev</code> function based on <a rel=\"nofollow noopener noreferrer\" target=\"_blank\" href=\"https://github.com/electron/electron/issues/7714#issuecomment-310885608\">this response</a> to a Github issue.</p>\n<p>So far so good! Let’s continue by making two edits to your <code class=\"language-text\">package.json</code>. The first is to make the <code class=\"language-text\">electron.js</code> file we just created the starting point of our app. In <code class=\"language-text\">package.json</code>, add a <code class=\"language-text\">main</code> property like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"public/electron.js\"</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>We also want to add a script that runs our app in Electron while developing. Add a new script called <code class=\"language-text\">app-dev</code> like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"app-dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"concurrently \\\"BROWSER=none npm run start\\\" \\\"wait-on http://localhost:3000 &amp;&amp; electron .\\\"\"</span></code></pre></div>\n<p>Your <code class=\"language-text\">package.json</code> should look like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-electron-app\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.1.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"private\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"public/electron.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"@testing-library/jest-dom\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.2.4\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@testing-library/react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^9.5.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@testing-library/user-event\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.2.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"react\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^16.13.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"react-dom\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^16.13.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"react-scripts\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"3.4.1\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts start\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts build\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts test\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"eject\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts eject\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"app-dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"concurrently \\\"BROWSER=none npm run start\\\" \\\"wait-on http://localhost:3000 &amp;&amp; electron .\\\"\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"eslintConfig\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"extends\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-app\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"browserslist\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"production\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\">0.2%\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"not dead\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"not op_mini all\"</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"development\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"last 1 chrome version\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"last 1 firefox version\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"last 1 safari version\"</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"devDependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"@rescripts/cli\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.14\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@rescripts/rescript-env\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.12\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"concurrently\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^5.1.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"electron\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^8.2.3\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"wait-on\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^4.0.2\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>We have everything set up to run it locally. We should use our script to launch the app in React, and then bring up an Electron window with the Chromium debugger. Let’s run our NPM script:</p>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">npm run app-dev</code></pre></div>\n<p>This is what we see:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6bb18ba6fb01073a7948e157fd84b9dc/966ce/screenshot01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACj0lEQVR42n1Uy27UQBDcH0G767U943l5/H7uZrOBDYhEcEEgpIQDghsH+AAkkCLOQVz4AfgDBCdOwIGPKnqckBdZDqX2jD3V3VU9Hq0WDfK2QVa0yMp/kRYNdnZ20HcNtJbo+w6LeY85xTnFpq7RNiUWfY26qjAKRI5QZBsR8AQi72G3biOMS3iRgS8TzByEhUeYRjHFGONAYhTpAlzlmyEz+HED0a5h6iV4sQBLW7CkwcyUCOIaHr2fqBI3Qn0N4TUJgoAhYiGS2MBohZigpYCIOARnkBGDEhzBzLtMyESKkLIwbi8R+iEHZwzGmAvQsHGM2MFaKKUwm83OCR2ZqraR3z+E7neHNVcn7wIWQdgMeVmjaRq0bQtbVBAxfcM4FRFSEfwqYYL68AXuHH/C4uVbav2vhnTIpBBZDR1bZBkRE7RNwBQZ5Ptn8LzTlhkJ71A8fIbV62M0T18hPN0bkkVyODCZTAaMx+MhetPpUJVDEAQnhK4tGVdQNBKa3Eu292AoGnLR7Q+k0iDLc1jSyiFN07Nn6apkAl5ArZPOI1eBzToUzRJlt6IhX6Hsb6Jqt5EU84FQKU3u6sEMKeXQdkVDnOcZducFHq0rPLhVoUj0ecthlIDbBqpfgyfdsHb7ESU0OelMrjrxHYYWKQoy4uPRAb59OcKvr2/weK+7ModOt1Oii3vcxOjXa2yt6AoutlDVdC0pSUQtfn7/HD9+fsDv7+9wcK/fMNhXkkgiLGhUEhqZpCxpbDpoal8Igf1ljid3SzzZb1Emigjp0P8giNCQISpLoEg/RlU5HSO6JU5TZlOMvRBTnw1OjyJyMpDFZtDPw1Yd6vmSXKXKpaZEZI6Oh8rT5RIqJVl4BJ8L/AG7edwOx27zywAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screenshot of running Electron app with debugger\"\n        title=\"\"\n        src=\"/static/6bb18ba6fb01073a7948e157fd84b9dc/0a47e/screenshot01.png\"\n        srcset=\"/static/6bb18ba6fb01073a7948e157fd84b9dc/8a4e8/screenshot01.png 150w,\n/static/6bb18ba6fb01073a7948e157fd84b9dc/5a46d/screenshot01.png 300w,\n/static/6bb18ba6fb01073a7948e157fd84b9dc/0a47e/screenshot01.png 600w,\n/static/6bb18ba6fb01073a7948e157fd84b9dc/1cfc2/screenshot01.png 900w,\n/static/6bb18ba6fb01073a7948e157fd84b9dc/c1b63/screenshot01.png 1200w,\n/static/6bb18ba6fb01073a7948e157fd84b9dc/966ce/screenshot01.png 2050w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Success! It has the same live reloading you have when developing in the browser. As you make changes to your code, your app is updated. When I develop, I usually have my debugger in a separate window so that my app has all of its real estate.</p>\n<p>Now that we got most things set up for development, let’s see how we can use Node.js module in our React apps in Electron.</p>\n<h2>Accessing Node.js Modules</h2>\n<p>If you were like me and needed access to a Node.js module, you’re out of luck. React is configured to run in the browser. This is set up by a webpack configuration that’s managed by <code class=\"language-text\">create-react-app</code>. If we want to edit it, we can always eject the app and manage the configuration and build system ourselves.</p>\n<p>When you eject your app, you get access to all the internals that build the app. However, managing all those libraries and configurations can be tedious. I rather keep <code class=\"language-text\">create-react-app</code>’s defaults so I can focus on my business logic over other technical issues. That’s why we installed <code class=\"language-text\">rescripts</code> earlier.</p>\n<p>We are going to use <code class=\"language-text\">rescripts</code> to change our webpack configuration so that React knows it’s running in Electron and not in the browser. By using <code class=\"language-text\">rescripts</code>, we don’t have to eject our application!</p>\n<p>In the project folder’s root directory, create a new file <code class=\"language-text\">.rescriptsrc.js</code> and add the following code:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">config</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    config<span class=\"token punctuation\">.</span>target <span class=\"token operator\">=</span> <span class=\"token string\">'electron-renderer'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> config<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This script modifies the webpack config used by React and changes its target to <code class=\"language-text\">electron-renderer</code> which would give us access to Node.js modules.</p>\n<p>Now in your <code class=\"language-text\">package.json</code>, we need to change the <code class=\"language-text\">scripts</code> property such that every place we use <code class=\"language-text\">react-scripts</code> will now have <code class=\"language-text\">rescripts</code>. Therefore, these lines:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts start\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts build\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts test\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"eject\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react-scripts eject\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"app-dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"concurrently \\\"BROWSER=none npm run start\\\" \\\"wait-on http://localhost:3000 &amp;&amp; electron .\\\"\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Should be changed to this:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"start\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rescripts start\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rescripts build\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rescripts test\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"eject\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"rescripts eject\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"app-dev\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"concurrently \\\"BROWSER=none npm run start\\\" \\\"wait-on http://localhost:3000 &amp;&amp; electron .\\\"\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span></code></pre></div>\n<p>Before we write code to test that it works, be sure that Electron is configured correctly as well. In the <code class=\"language-text\">createWindow()</code> function of <code class=\"language-text\">public/electron.js</code>, when you create a new <code class=\"language-text\">BrowserWindow</code> object you must have the following properties set:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token literal-property property\">webPreferences</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">nodeIntegration</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>That property inserts the <code class=\"language-text\">require</code> function into the DOM. By default, it’s set to <code class=\"language-text\">false</code>. Our earlier example code already sets it to true but just be sure you do the same in future projects!</p>\n<p>Let’s try to use a Node.js module in our React code to see if it works. If you still have the app running from earlier, exit so that we can start the app using <code class=\"language-text\">rescripts</code>. We’ll use the <code class=\"language-text\">fs</code> module to list all the files and folders in the current directory.</p>\n<p>In <code class=\"language-text\">src/App.js</code> add the following code before the function that creates the main <code class=\"language-text\">App</code> component:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>promises<span class=\"token punctuation\">;</span>\nfs<span class=\"token punctuation\">.</span><span class=\"token function\">readdir</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>\n  <span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">files</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    files<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">file</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>file<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>\n  <span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In our app, our debugger should now look like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2fd2f94e759d42deaecb4062e22fcbef/966ce/screenshot02.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACc0lEQVR42oWTy27TQBSGA0IUVSBQhWiLUqp47PElduPYHo89tutcm9KqRbTlsoIFbGHDA7DgDdjwCrzlz/EkRG1Ky+LTmWPL/5zL79awypEUOWKhEKf/ZjgeYzqdoqoq+L6PPM9R1zXlJZ2VjmWpUA8GaFleDP4f+lECVRRIU4kkSZCRYColgiBAGPahKFd5BqUUWm6QwPFvhnsRQhKsqn3ILEMvDEloTxPFiRaOE6HFhBBoXRMJxJxFbndjEol0ha7rwjTNJYwxTafTQRRF1wVtqobzALbbv1JhFAvs1wMtyLl1CQ7btmGRuJQpIS8JUiVeXCA5+4ignF25pNeXEFkF1+uhY/AFNgw2Z3fXpLYziHRlhtmHLzj6+RvV1+/Ltm0/RiEZhuoFlHiOSrZRpgsoHxYMA8XwcuyjpjMJCvoogWXvQbz5hMmPX1Cfv+nZ2d3FRdETnB9s4GK2iXdHW3h/vI2Lw2eYqHWM5ANM8nUM0jWUydq85W4vRdDP4VMM92cI85E++2GmZzjIN/H2eAdnhzt4PWtjWm6gEg+R+PcQeXcQd++i77WQhffR0ltsZpfVSIsxmXxEcQSpRuiLiqqMUMunOJ9t4dVkG6fjbYzyxzgg0RlxMm7jZLKD00kbRfJo0TKJ8mazvQx+cQA3LnXePG86MLlDNjFoqyYc29K4DqdIW26ecQZuMXKBveLDZm6N8EJoaR3uar8ZzCIa/5nLOMeirTM4jnuDsVf/Fl0hu2LqVZoLHcchQZqRS9a4DZs35jUItsRkcxgz5n+MYdAIqGU3VLACeSuGE6BDVXao9b9YjkdW82jWHo3JA6P3XhDiDx1q0N1S3wUFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Screenshot of running Electron app using the fs Node.js module to list files and folders in the current directory\"\n        title=\"\"\n        src=\"/static/2fd2f94e759d42deaecb4062e22fcbef/0a47e/screenshot02.png\"\n        srcset=\"/static/2fd2f94e759d42deaecb4062e22fcbef/8a4e8/screenshot02.png 150w,\n/static/2fd2f94e759d42deaecb4062e22fcbef/5a46d/screenshot02.png 300w,\n/static/2fd2f94e759d42deaecb4062e22fcbef/0a47e/screenshot02.png 600w,\n/static/2fd2f94e759d42deaecb4062e22fcbef/1cfc2/screenshot02.png 900w,\n/static/2fd2f94e759d42deaecb4062e22fcbef/c1b63/screenshot02.png 1200w,\n/static/2fd2f94e759d42deaecb4062e22fcbef/966ce/screenshot02.png 2050w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Sweet! The debugger shows the logs of the files and folders in the current directory, proving we got Node.js integration working as we need it to.</p>\n<h2>Moving Forward</h2>\n<p>This got me into a pretty happy place. It’s helping me build my Arduboy game uploader and I’ll probably continue to use this setup for future Desktop apps I’m building with React. You can see the code for this tutorial here: <a rel=\"nofollow noopener noreferrer\" target=\"_blank\" href=\"https://github.com/msanatan/react-electron-app\"><a href=\"https://github.com/msanatan/react-electron-app\">https://github.com/msanatan/react-electron-app</a></a>.</p>\n<p>Happy app developing!</p>","frontmatter":{"title":"Accessing Node.js Modules with Create React App and Electron","tags":["javascript","react","electron"],"date":"2020-04-19","updated":null}},"previous":{"fields":{"slug":"/blog/2020/04/13/my-first-arduboy-game-the-social-distance-game"},"frontmatter":{"title":"My First Arduboy Game - The Social Distance Game"}},"next":{"fields":{"slug":"/blog/2020/04/19/encoding-and-returning-large-json-in-golang"},"frontmatter":{"title":"Encoding and Returning Large JSON in Golang"}}},"pageContext":{"id":"f68b0bed-ac21-502d-8995-4c31536c1969","previousPostId":"1b347eff-fac9-54a3-acfe-345c38f98a08","nextPostId":"006738a2-a2b1-5b26-8895-1e3ce14f3d18"}},"staticQueryHashes":["1391858338"],"slicesMap":{}}